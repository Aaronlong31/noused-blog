---
layout: post
title: tomcat 绑定域名 防止恶意域名绑定
wordpress_id: 568
wordpress_url: http://www.zlong.org/?p=568
categories:
- tomcat
tags: []
---
今天公司一台服务器被很多恶意域名绑定了，电信的要我们赶紧处理，否则封IP。服务器使用的是tomcat，上谷歌搜了很多方法，都是说绑定自己的域名，没说如何不让其他域名绑定。开始我想了一种方法：修改tomcat/conf/server.xml，找到engine元素，仿照已有的localhost，添加host元素，比如你想禁止www.fff.com，可以这样写：<!--more-->[xml]&lt;Host name=&quot;www.fff.com&quot;  appBase=&quot;notexists&quot;unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot;xmlValidation=&quot;false&quot; xmlNamespaceAware=&quot;false&quot;&gt;&lt;/Host&gt;[/xml]其中的appBase是一个不存在的目录，所以www.fff.com请求时，不会访问你真实的应用。但这样只能禁止www.fff.com，不会禁止fff.com，所以还得加个name为fff.com的host，这样就太麻烦了，并且一些恶意域名是不可预知的，你并不知道会有多少域名绑定到你的IP，所以这种方式行不通。上面的方式是默认允许，把禁止的列出来，变换下思路，默认禁止，将允许的列出来，这样不就OK了？所以有第二种方式：[xml]&lt;!-- default host is forbiden --&gt;&lt;Engine name=&quot;Catalina&quot; defaultHost=&quot;forbiden&quot;&gt;&lt;Realm className=&quot;org.apache.catalina.realm.UserDatabaseRealm&quot;resourceName=&quot;UserDatabase&quot;/&gt;  &lt;!-- allow hosts --&gt;&lt;Host name=&quot;localhost&quot;  appBase=&quot;webapps&quot;unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot;xmlValidation=&quot;false&quot; xmlNamespaceAware=&quot;false&quot;&gt;&lt;/Host&gt;&lt;Host name=&quot;www.zh56.mobi&quot;  appBase=&quot;webapps&quot;unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot;xmlValidation=&quot;false&quot; xmlNamespaceAware=&quot;false&quot;&gt;&lt;/Host&gt; &lt;Host name=&quot;222.73.227.231&quot;  appBase=&quot;webapps&quot;unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot;xmlValidation=&quot;false&quot; xmlNamespaceAware=&quot;false&quot;&gt;&lt;/Host&gt; &lt;!-- forbiden host, the appBase is a not exists directory. If the requested domain is not in the above list of hosts where are allowed, then use this host.        我后来才知道，这个host可以不要。--&gt;&lt;Host name=&quot;forbiden&quot;  appBase=&quot;notexists&quot;unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot;xmlValidation=&quot;false&quot; xmlNamespaceAware=&quot;false&quot;&gt;&lt;/Host&gt;&lt;/Engine&gt;[/xml]这里将Engine中的defaultHost设置为forbiden，下面有个name为forbiden的host，其appBase是个不存在的目录。再添加允许的host。所以，如果是未知的域名，则会使用forbiden的host，这样就访问不到真实应用目录了。2011-07-14：以上的方法运行了几天还行，但今天就报错了。之前项目的jar全放在tomcat/lib下，现在改放到WEB-INF/lib下，项目启动时就报错了。看控制台信息，发现项目被启动了3次，我想应该是我配置了3个host吧，但之前为什么不报错呢？很是奇怪，到现在我还没弄明白。于是我就只留了一个host，只让域名能访问。
