<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ajax传long型值的问题</title>
    <link rel="stylesheet" href="/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/css/pygments/highlight.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.8.0.min.js"></script>
    <script type="text/javascript" src="/js/bootstrap.min.js"></script>
</head>
<body data-spy="scroll" data-target=".bs_docs_sidebar">
    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="navbar-inner">
            <div class="container">
                <a href="/index.html" class="brand">Aaron's Blog</a>
                <div class="nav-collapse collapse">
                    <ul class="nav">
                        <li><a href="/index.html">Home</a></li>
                        <li><a href="/tags">Tags</a></li>
                        <li><a href="/topics">Topics</a></li>
                    </ul> 
                </div>
            </div>
        </div>
    </div>
    <header class="jumbotron subhead">
        <a href="https://github.com/Aaronlong31/aaronlong31.github.com" id="forkme_banner">View on GitHub</a>
    <div class="container">
        <h1>ajax传long型值的问题</h1>
        
    </div>
    </header>
    <div class="container">
    <p>今天使用struts2的json-plugin时，遇到一个问题，我有一个model，Person：[java]public class Person{private long personId;private String personName;}[/java]使用ajax方式向浏览器传值时，如果personId的值很长，比如：-1234567890123456789，传到浏览器时，personId变成了-1234567890123456700，会对后面两位数四舍五入。遇到这个问题，感觉很神奇，我以为是struts2-json-plugin的问题，于是我将struts2-json-plugin升级到了2.2.3，问题还是出现。但是我直接在浏览器中输入ajax的url，得到的输出确是对的，google后才知道js不支持Long型，会对long型做了处理，省略了后两位，所以我们不能直接传long值，要将Long型的转成string。但在哪转又是个问题，我想，这个问题应该会很常见的，不会是我第一个发现的，json-plugin肯定也知道这个问题，所以会有些设置什么，我猜测是用annotation给特定字段设置的。于是我找json-plugin的annotation，发现了@JSONFieldBridge，将其加在getPersonId()方法上，一试居然可以，问题解决了！<strong>注意JSONFieldBridge在2.1.8中没有，2.2.3中新增的。</strong>我又仔细研究了JSONFieldBridge，发现它还有个参数，是org.apache.struts2.json.bridge.FieldBridge的子类，FieldBridge只申明了一个方法，objectToString(Object obj)，重写该方法即可修改json序列化字段的方式，JSONFieldBridge默认使用org.apache.struts2.json.bridge.StringBridge，它只是调用了obj的toString()方法，所以对解决long型问题，用默认的StringBridge就够了。发现这些后，我又想到了一个方法，如果在Person中有个birthday字段，long型，ajax传到前台时，可以将long型日期转换成特定格式的日期字符串，以下是自定义的FieldBridge实现，DateFieldBridge:[java]import java.text.SimpleDateFormat;import java.util.Date;import org.apache.struts2.json.bridge.FieldBridge;public class DateFieldBridge implements FieldBridge {@Overridepublic String objectToString(Object obj) {if (obj == null) {return null;}if (obj instanceof Long) {SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);Date date = new Date();date.setTime((Long) obj);return sdf.format(date);}return obj.toString();}}[/java]</p>
 
    
    </div>
    <footer class="footer">
    <div class="container">
        <p>Maintained by <a href="https://github.com/Aaronlong31">Aaronlong31</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
    </div>
    </footer>
</body>
</html>
