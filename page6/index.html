<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Aaron's Blog</title>
    <link rel="stylesheet" href="/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/css/pygments/highlight.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.8.0.min.js"></script>
    <script type="text/javascript" src="/js/bootstrap.min.js"></script>
</head>
<body data-spy="scroll" data-target=".bs_docs_sidebar">
    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="navbar-inner">
            <div class="container">
                <a href="/index.html" class="brand">Aaron's Blog</a>
                <div class="nav-collapse collapse">
                    <ul class="nav">
                        <li><a href="/index.html">Home</a></li>
                    </ul> 
                </div>
            </div>
        </div>
    </div>
    <header class="jumbotron subhead">
        <a href="https://github.com/Aaronlong31/aaronlong31.github.com" id="forkme_banner">View on GitHub</a>
    <div class="container">
        <h1>Aaron's Blog</h1>
        
    </div>
    </header>
    <div class="container">
    
<h1><a href="/tomcat/2011/07/13/tomcat-binding-domain-bound-to-prevent-malicious-domain.html">tomcat 绑定域名 防止恶意域名绑定</a></h1>
<p class="author">
<span class="date">2011-07-13 00:00:00 +0800</span>
</p>
<div class="content">
    <p>今天公司一台服务器被很多恶意域名绑定了，电信的要我们赶紧处理，否则封IP。服务器使用的是tomcat，上谷歌搜了很多方法，都是说绑定自己的域名，没说如何不让其他域名绑定。开始我想了一种方法：修改tomcat/conf/server.xml，找到engine元素，仿照已有的localhost，添加host元素，比如你想禁止www.fff.com，可以这样写：<!--more-->[xml]&lt;Host name=&quot;www.fff.com&quot;  appBase=&quot;notexists&quot;unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot;xmlValidation=&quot;false&quot; xmlNamespaceAware=&quot;false&quot;&gt;&lt;/Host&gt;[/xml]其中的appBase是一个不存在的目录，所以www.fff.com请求时，不会访问你真实的应用。但这样只能禁止www.fff.com，不会禁止fff.com，所以还得加个name为fff.com的host，这样就太麻烦了，并且一些恶意域名是不可预知的，你并不知道会有多少域名绑定到你的IP，所以这种方式行不通。上面的方式是默认允许，把禁止的列出来，变换下思路，默认禁止，将允许的列出来，这样不就OK了？所以有第二种方式：[xml]&lt;!-- default host is forbiden --&gt;&lt;Engine name=&quot;Catalina&quot; defaultHost=&quot;forbiden&quot;&gt;&lt;Realm className=&quot;org.apache.catalina.realm.UserDatabaseRealm&quot;resourceName=&quot;UserDatabase&quot;/&gt;  &lt;!-- allow hosts --&gt;&lt;Host name=&quot;localhost&quot;  appBase=&quot;webapps&quot;unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot;xmlValidation=&quot;false&quot; xmlNamespaceAware=&quot;false&quot;&gt;&lt;/Host&gt;&lt;Host name=&quot;www.zh56.mobi&quot;  appBase=&quot;webapps&quot;unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot;xmlValidation=&quot;false&quot; xmlNamespaceAware=&quot;false&quot;&gt;&lt;/Host&gt; &lt;Host name=&quot;222.73.227.231&quot;  appBase=&quot;webapps&quot;unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot;xmlValidation=&quot;false&quot; xmlNamespaceAware=&quot;false&quot;&gt;&lt;/Host&gt; &lt;!-- forbiden host, the appBase is a not exists directory. If the requested domain is not in the above list of hosts where are allowed, then use this host.        我后来才知道，这个host可以不要。--&gt;&lt;Host name=&quot;forbiden&quot;  appBase=&quot;notexists&quot;unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot;xmlValidation=&quot;false&quot; xmlNamespaceAware=&quot;false&quot;&gt;&lt;/Host&gt;&lt;/Engine&gt;[/xml]这里将Engine中的defaultHost设置为forbiden，下面有个name为forbiden的host，其appBase是个不存在的目录。再添加允许的host。所以，如果是未知的域名，则会使用forbiden的host，这样就访问不到真实应用目录了。2011-07-14：以上的方法运行了几天还行，但今天就报错了。之前项目的jar全放在tomcat/lib下，现在改放到WEB-INF/lib下，项目启动时就报错了。看控制台信息，发现项目被启动了3次，我想应该是我配置了3个host吧，但之前为什么不报错呢？很是奇怪，到现在我还没弄明白。于是我就只留了一个host，只让域名能访问。</p>

</div>
<hr/>

<h1><a href="/mysql/database/2011/07/07/mysql-can-t-get-hostname-for-your-address.html">mysql-can't get hostname for your address</a></h1>
<p class="author">
<span class="date">2011-07-07 00:00:00 +0800</span>
</p>
<div class="content">
    <p>新搭建了个服务器环境，装了mysql，远程连接是出现以下错误：[shell]ERROR 1042 (HY000): Can't get hostname for your address[/shell]GOOGLE后问题解决，记录一下。在my.ini中的[mysqld]加入skip-name-resolve，重启mysql即可。<!--more-->禁止MySQL对外部连接进行DNS解析，使用这一选项可以消除MySQL进行DNS解析的时间。但需要注意，如果开启该选项，则所有远程主机连接授权都要使用IP地址方式，否则MySQL将无法正常处理连接请求!#1：去掉mysql启动参数中的skip-name-resolve ，然后jdbc连接串用ip地址和主机名均可。#2：如果保留启动参数skip-name-resolve 的话，在jdbc连接串中只能使用IP地址的方式连接数据库。</p>

</div>
<hr/>

<h1><a href="/java/struts2/2011/07/01/ajax-passed-long-value-problem.html">ajax传long型值的问题</a></h1>
<p class="author">
<span class="date">2011-07-01 00:00:00 +0800</span>
</p>
<div class="content">
    <p>今天使用struts2的json-plugin时，遇到一个问题，我有一个model，Person：[java]public class Person{private long personId;private String personName;}[/java]使用ajax方式向浏览器传值时，如果personId的值很长，比如：-1234567890123456789，传到浏览器时，personId变成了-1234567890123456700，会对后面两位数四舍五入。遇到这个问题，感觉很神奇，我以为是struts2-json-plugin的问题，于是我将struts2-json-plugin升级到了2.2.3，问题还是出现。但是我直接在浏览器中输入ajax的url，得到的输出确是对的，google后才知道js不支持Long型，会对long型做了处理，省略了后两位，所以我们不能直接传long值，要将Long型的转成string。但在哪转又是个问题，我想，这个问题应该会很常见的，不会是我第一个发现的，json-plugin肯定也知道这个问题，所以会有些设置什么，我猜测是用annotation给特定字段设置的。于是我找json-plugin的annotation，发现了@JSONFieldBridge，将其加在getPersonId()方法上，一试居然可以，问题解决了！<strong>注意JSONFieldBridge在2.1.8中没有，2.2.3中新增的。</strong>我又仔细研究了JSONFieldBridge，发现它还有个参数，是org.apache.struts2.json.bridge.FieldBridge的子类，FieldBridge只申明了一个方法，objectToString(Object obj)，重写该方法即可修改json序列化字段的方式，JSONFieldBridge默认使用org.apache.struts2.json.bridge.StringBridge，它只是调用了obj的toString()方法，所以对解决long型问题，用默认的StringBridge就够了。发现这些后，我又想到了一个方法，如果在Person中有个birthday字段，long型，ajax传到前台时，可以将long型日期转换成特定格式的日期字符串，以下是自定义的FieldBridge实现，DateFieldBridge:[java]import java.text.SimpleDateFormat;import java.util.Date;import org.apache.struts2.json.bridge.FieldBridge;public class DateFieldBridge implements FieldBridge {@Overridepublic String objectToString(Object obj) {if (obj == null) {return null;}if (obj instanceof Long) {SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);Date date = new Date();date.setTime((Long) obj);return sdf.format(date);}return obj.toString();}}[/java]</p>

</div>
<hr/>


<!-- Pagination links -->
<div class="pagination">
    <ul>
        
        <li>
        
        <a href="/page5">«</a>
        
        </li>
        

        
        <li><a href="/">1</a></li>
        

        
        
        <li><a href="/page2">2</a> </li>
        
        
        
        <li><a href="/page3">3</a> </li>
        
        
        
        <li><a href="/page4">4</a> </li>
        
        
        
        <li><a href="/page5">5</a> </li>
        
        
        
        <li class="active"><a href="javascript:void(0)">6</a></li>
        
        
        
        <li><a href="/page7">7</a> </li>
        
        
        
        <li><a href="/page8">8</a> </li>
        
        
        
        <li><a href="/page9">9</a> </li>
        
        
        
        <li><a href="/page10">10</a> </li>
        
        
        
        <li><a href="/page11">11</a> </li>
        
        
        
        <li><a href="/page12">12</a> </li>
        
        
        
        <li><a href="/page13">13</a> </li>
        
        
        
        <li><a href="/page14">14</a> </li>
        
        
        
        <li><a href="/page15">15</a> </li>
        
        
        
        <li><a href="/page16">16</a> </li>
        
        

        
        <li><a href="/page7">»</a></li>
        
    </ul>
</div>
 
    </div>
    <footer class="footer">
    <div class="container">
        <p>Maintained by <a href="https://github.com/Aaronlong31">Aaronlong31</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
    </div>
    </footer>
</body>
</html>
